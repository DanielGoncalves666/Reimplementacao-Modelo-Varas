# Implementation of the Varas model for Pedestrian Evacuation

This repository contains an implementation of the Varas model for pedestrian evacuation using cellular automata.

A notable difference from the model described by Varas in his 2007 article to this implementation is that X movements aren't allowed. In the pedestrian evacuation process, X movements occur when two pedestrians try to move in a way that would cause them to collide in real life situations. To enhance realism, only one of the pedestrians is randomly allowed to move on these situations.

The described addition can be deactivated using the `--allow-x-movement` flag.

## Terminology

### Simulation

The term **simulation** stands for a single execution of the evacuation process, which begins when pedestrians are placed in the environment and ends when the environment is empty.

### Simulation Set

The term **simulation set** refers to a group of simulations with the same parameters, except for the **seed** parameter, which changes from one simulation to the next.

## How to compile and run

To compile and run the program, execute the following command in your shell, replacing `[arguments]` with the desired command-line arguments:

```bash
./varas.sh [arguments]
```

## Input and Output Files

### Environment Files

The environment files must be placed in the `environment/` directory. Each file must contain, in its first line, the dimensions of the environment (number of lines and columns, respectively). The subsequent lines must represent the actual environment, drawn with the following symbols:

|Symbol    | Meaning              |
|    ---   |        ---           |
| \#       | Walls and obstacles  |
| p or P   | Pedestrians          |
| _        | Exits                |
| .        | Nothing              |

### Auxiliary Files

The auxiliary files must be placed in the `auxiliary/` directory. An auxiliary file contains, in each of its lines, the coordinates of the exits to be used in a single **simulation set** for the environment load methods that don't use static exits. Environment load methods that don't require an auxiliary file will simply ignore it if provided.

The following syntax must be used when writing the content of an auxiliary file:

1. Commas (`,`) are used to separate different exits in a single **simulation set**.
2. The addition symbol (`+`) is used to indicate that the next pair of coordinates is part of the same exit (an exit expansion).
3. A period (`.`) is used to indicate the end of the list of coordinates for a **simulation set**.

#### Example without expansion

```text
line1 column1, line2 column2, [...], lineN columnN.
```

#### Example with expansion

```text
line1_1 column1_1+ line1_2 column1_2, [...].
```

#### Observations

1. There is no upper limit to the number of different exits or the number of coordinates attached to a single exit. Furthermore, even if the coordinates for a single exit aren't adjacent, the simulation set is still considered valid.

2. Repetitive exits are accepted in a single simulation set and are treated as distinct exits by the program. This can cause inconsistencies, as more than one pedestrian can exit the environment from the same place.

### Output Files

The output files, generated by the program, are placed in the `output` directory. If the -o option is not provided when running the program, the output data will be printed to stdout. If the -o option is provided without specifying a filename, a name is automatically generated for the output file.

## Program's help message

```text
Usage: varas.exe [OPTION...]
Varas - Simulates pedestrian evacuation using the Varas (2007) model.

  
Files:

  -a, --auxiliary-file=AUXILIARY-FILE
                             Name of the configuration file that contains the
                             coordinates of exits for each simulation set.
  -e, --env-file=ENV-FILE    Name of the file that contains environment
                             information: dimensions and its mapped features,
                             including obstacles, walls, and optionally,
                             pedestrians and doors.
  -o, --output-file[=OUTPUT-FILE]
                             Specifies whether the output should be stored in a
                             file (default is stdout), with the file name being
                             optionally provided.
  
Input/Output Configuration:

  -m, --env-load-method=METHOD   How the environment will be loaded or whether
                             it will be created.
  -O, --output-format=FORMAT The type of output to be generated by the
                             simulations.
  
Environment Dimensions (required for auto created environments):

  -c, --col=COLUMNS          Number of columns for the environment when it is
                             being created.
  -l, --lin=LINES            Number of lines for the environment when it is
                             being created.
  
Simulation Variables (optional):

      --diagonal=DIAGONAL    The diagonal value for calculation of the static
                             floor field (default is 1.5).
  -p, --ped=PEDESTRIANS      Number of pedestrians to be randomly placed in the
                             environment (default is 1).
      --seed=SEED            Initial seed for the srand function (default is
                             0).
  -s, --simu=SIMULATIONS     Number of simulations for each simulation set
                             (default is 1).
  
Toggle Options (optional):

      --allow-x-movement     The movement of pedestrians isn't restricted when
                             X movements occur.
      --always-to-lowest     The pedestrians will always try to move to the
                             lowest cell in their neighborhood. If it is
                             occupied, they will wait for it to become empty.
      --avoid-corner-movement   Prevents movement in the corners of walls and
                             obstacles. A single diagonal movement through the
                             corner of a obstacle becomes three movements.
      --debug                Prints debug information to stdout.
      --immediate-exit       The pedestrians will exit the environment the
                             moment they reach an exit, instead of waiting a
                             timestep in the LEAVING state.
      --simulation-set-info  Prints simulation set information (exits
                             coordinates) to the output file.
      --single-exit-flag     Prints a flag (#1) before the results for every
                             simulation set that has only one exit.
      --varas-fig7           Doesn't allow any pedestrians to be randomly
                             placed in the first two columns on the left of the
                             environment, in accordance with the experiment in
                             Fig. 7 of the Varas article.
  
Additional Information:

  -?, --help                 Give this help list
      --usage                Give a short usage message
  -V, --version              Print program version

Mandatory or optional arguments to long options are also mandatory or optional
for any corresponding short options.

If no file is provided with --env-file, the varas_queue.txt file will be used.
The file provided with --auxiliary-file must contain, on each line, the
coordinates of the exits for a single simulation set. The syntax to be used is
described in the project's readme.

The --env-load-method option specifies whether the environment will be created
or loaded from the file provided by --env-file, as well as how it will be
loaded if applicable. The following choices are available:
        Environment loaded from a file:
                1 - Only the environment structure (walls and obstacles).
                2 - Environment structure and static exits.
                3 - Environment structure and static pedestrians.
                4 - (default) Environment structure, static exits and static pedestrians.
        Environment auto created:
                5 - Environment structure will be a empty room with dimensions of LINES and
COLUMNS (including the walls surrounding it).
Choices 1, 3 and 5 require the file provided by the --auxiliary-file option in
order to include exits in the simulation.

The --output-format option specifies which data generated by the simulations
shall be written to the output stream. The following choices are available:
         1 - (default) Visual print of the environment.
         2 - Number of timesteps required for the termination of each simulation.
         3 - Heatmap of the environment cells.

Unnecessary options for some --env-load-method are ignored.
```
